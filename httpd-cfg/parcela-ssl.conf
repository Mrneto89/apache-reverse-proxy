<VirtualHost *:80>
        DocumentRoot /var/www/html
        ServerName app-parcela.apps.dtcn.detran.ce.gov.br

        # Admin Console
        ProxyPreserveHost On
        ProxyPass               /    http://ruby:8080/
        ProxyPassReverse        /    http://ruby:8080/        

        CustomLog    logs/app-parcela.apps.dtcn.detran.ce.gov.br-access_log combined
        ErrorLog    logs/app-parcela.apps.dtcn.detran.ce.gov.br-error_log

RewriteEngine On
RewriteCond %{HTTPS} !on
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
RewriteCond %{SERVER_NAME} =app-parcela.apps.dtcn.detran.ce.gov.br
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<VirtualHost *:8080>
        DocumentRoot /var/www/html
        ServerName app-parcela.apps.dtcn.detran.ce.gov.br

        ProxyPreserveHost On

        ProxyPass               /    http://ruby:8080/
        ProxyPassReverse        /    http://ruby:8080/

        CustomLog    logs/app-parcela.apps.dtcn.detran.ce.gov.br-access_log combined
        ErrorLog    logs/app-parcela.apps.dtcn.detran.ce.gov.br-error_log
</VirtualHost>

<VirtualHost *:443>
        DocumentRoot /var/www/html
        ServerName app-parcela.apps.dtcn.detran.ce.gov.br        

        #Timeout 300

        SSLEngine on
        SSLProxyEngine On
        RequestHeader set Front-End-Https "On"
        ProxyPreserveHost On

        ProxyPass               /    http://ruby:8080/
        ProxyPassReverse        /    http://ruby:8080/

        # Lets Encryt Test

        CustomLog    logs/app-parcela.apps.dtcn.detran.ce.gov.br-access_log combined
        ErrorLog logs/app-parcela.apps.dtcn.detran.ce.gov.br-error_log

        # SSLCertificateFile       /etc/letsencrypt/live/app-parcela.apps.dtcn.detran.ce.gov.br/fullchain.pem
        # SSLCertificateKeyFile    /etc/letsencrypt/live/app-parcela.apps.dtcn.detran.ce.gov.br/privkey.pem
        SSLCertificateFile      "/opt/app-root/httpd-ssl/certs/_.apps.dtcn.detran.ce.gov.br.pem"
        SSLCACertificateFile    "/opt/app-root/httpd-ssl/certs/ca.pem"
        SSLCertificateKeyFile   "/opt/app-root/httpd-ssl/private/_.apps.dtcn.detran.ce.gov.br.pem"
        # Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>